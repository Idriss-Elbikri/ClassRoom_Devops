trigger:
  branches:
    include:
      - main

pool:
  vmImage: 'ubuntu-latest'

variables:
  artifactName: 'drop'
  warFileName: 'ClassRoom.war'

steps:
# Vérifier les versions de Maven et Java
- script: |
    mvn -v
  displayName: '🔍 Vérifier la version de Maven'

# Étape 0 : Installer Java 17 via commande shell
- script: |
    sudo apt-get update
    sudo apt-get install -y openjdk-17-jdk
    java -version
  displayName: '☕ Installer Java 17'

# Étape 1 : Build avec Maven
- task: Maven@3
  displayName: '🔧 Build avec Maven'
  inputs:
    mavenPomFile: 'pom.xml'
    goals: 'clean package'
    options: '-DskipTests=true'  # Utilisation d'options minimales ici

# Étape 2 : Copier le fichier .war
- task: CopyFiles@2
  displayName: '📦 Copier le .war'
  inputs:
    contents: '**/target/*.war'
    targetFolder: '$(Build.ArtifactStagingDirectory)'

# Étape 3 : Publier l'artefact .war pour la Release
- task: PublishBuildArtifacts@1
  displayName: '📤 Publier Artefact .war'
  inputs:
    pathToPublish: '$(Build.ArtifactStagingDirectory)'
    artifactName: '$(artifactName)'

# Ignorer l'étape de tests (si nécessaire)
- task: PublishTestResults@2
  condition: false  # Ne pas exécuter cette étape
  displayName: '📋 Publier les résultats des tests (désactivé)'

